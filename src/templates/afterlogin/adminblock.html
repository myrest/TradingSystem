<div class="crypto-table">
    <h2>貨幣資料</h2>
    <button onclick="showAddModal()">新增貨幣</button>
    <table id="cryptoTable">
        <thead>
            <tr>
                <th>幣種</th>
                <th>憑證</th>
                <th>狀態</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            <!-- 數據將通過JavaScript動態添加 -->
        </tbody>
    </table>
</div>
</div>

<!-- 新增/編輯貨幣的模態框 -->
<div id="cryptoModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2 id="modalTitle">新增/編輯貨幣</h2>
        <p>
            <strong>幣種：</strong>
            <input type="text" id="modalCoin" placeholder="Enter Coin">
        </p>
        <p>
            <strong>資料：</strong>
            <textarea id="modalData" placeholder="Enter Data"></textarea>
        </p>
        <button onclick="saveCrypto()">保存</button>
    </div>
</div>

<!-- 顯示資料內容的模態框 -->
<div id="dataModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeDataModal()">&times;</span>
        <h2 id="dataModalTitle"></h2>
        <p id="dataModalContent"></p>
    </div>
</div>




<script>
    document.getElementById('save-button').addEventListener('click', function () {
        const newItem = document.getElementById('new-item').value.toUpperCase();
        if (newItem) {
            const data = {
                'symbol': newItem
            }
            fetch('/restadmin/symbol', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            }).then(response => {
                if (response.ok) {
                    response.json().then(data => {
                        cert = data.data
                        const tbody = document.getElementById('item-table-body');
                        const row = document.createElement('tr');
                        row.innerHTML = `
                <td>${newItem}</td>
                <td>${cert}</td>
                <td>
                    <span class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="status-${newItem}" id="enable-${newItem}" value="true">
                        <label class="form-check-label inline" for="enable-${newItem}">啟用</label>
                    </span>
                    <span class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="status-${newItem}" id="disable-${newItem}" value="false" checked>
                        <label class="form-check-label inline" for="disable-${newItem}">停用</label>
                    </span>
                </td>
            `;
                        tbody.appendChild(row);
                        attachEventListeners(row); // Attach event listeners to the new row

                        // Hide the form and clear the input
                        document.getElementById('new-item-form').style.display = 'none';
                        document.getElementById('new-item').value = '';
                    })
                } else {
                    response.json().then(error => {
                        // Handle update error
                        console.error('Error updating customer:', error);
                    });
                }
            }).catch(error => {
                console.error('Error:', error);
            });
        }
    });

    function attachEventListeners(row) {
        row.querySelectorAll('.form-check-input').forEach(radio => {
            radio.addEventListener('change', function () {
                const data = {
                    'symbol': this.name.split('-')[1],
                    'status': this.value
                }
                fetch(`/restadmin/symbol`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                }).then(response => {
                    if (!response.ok) {
                        console.error(`Failed to update status for item ${item} to ${status}`);
                    }
                });
            });
        });
    }

    // Fetch and populate Symbol data on page load
    function fetchSymbolData() {
        fetch('/restadmin/symbol')
            .then(response => {
                if (response.ok) {
                    response.json().then(data => {
                        console.log(data)
                        if (!response.ok) {
                            return;
                        }
                        const tbody = document.getElementById('item-table-body');
                        data.forEach(Symbol => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                    <td>${Symbol.symbol}</td>
                    <td>${Symbol.cert}</td>
                    <td>
                        <span class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="status-${Symbol.symbol}" id="enable-${Symbol.symbol}" value="true" ${Symbol.status ? 'checked' : ''}>
                            <label class="form-check-label inline" for="enable-${Symbol.symbol}">啟用</label>
                        </span>
                        <span class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="status-${Symbol.symbol}" id="disable-${Symbol.symbol}" value="false" ${!Symbol.status ? 'checked' : ''}>
                            <label class="form-check-label inline" for="disable-${Symbol.symbol}">停用</label>
                        </span>
                    </td>
                `;
                            tbody.appendChild(row);
                            attachEventListeners(row); // Attach event listeners to the new row
                        });
                    })
                        .catch(error => {
                            console.error('Error fetching Symbol data:', error);
                        });
                }
            })
    }

    document.addEventListener('DOMContentLoaded', fetchSymbolData);
</script>